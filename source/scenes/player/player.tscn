[gd_scene format=3 uid="uid://cxk27w5ficlco"]

[ext_resource type="Script" uid="uid://bvt0l60nmgv4s" path="res://scripts/player/player_controller.gd" id="1_rkuj1"]
[ext_resource type="Script" uid="uid://v23xafiwc0lo" path="res://scripts/input/input_gather.gd" id="2_0owmy"]
[ext_resource type="Material" uid="uid://cw3vtka5voiak" path="res://assets/materials/dither.tres" id="2_h17s1"]
[ext_resource type="Script" uid="uid://0x2i8kdr51fu" path="res://scripts/camera/camera_movement.gd" id="2_qek5x"]
[ext_resource type="Texture2D" uid="uid://cdr3agq0jdx7y" path="res://assets/textures/colors.tres" id="3_8ydkj"]
[ext_resource type="Script" uid="uid://cu4pxvtbu3ogn" path="res://scripts/camera/dynamic_sway_recoil.gd" id="3_ioxgp"]
[ext_resource type="Script" uid="uid://dlyn7myxb1v18" path="res://scripts/statemachine/statemachine.gd" id="5_5tt2p"]
[ext_resource type="PackedScene" uid="uid://dg7xl4dtseqsv" path="res://scenes/outline_pixelate.tscn" id="5_kvlxm"]
[ext_resource type="Script" uid="uid://c5cfuh8tg3iw5" path="res://scripts/camera/hand_camera.gd" id="6_fm80t"]
[ext_resource type="Script" uid="uid://bs6sc1frb1nfc" path="res://scripts/player/ground/idle.gd" id="6_rkuj1"]
[ext_resource type="Script" uid="uid://b01bw7djd0wvp" path="res://scripts/player/ground/walk.gd" id="7_ers80"]
[ext_resource type="Script" uid="uid://dmw47mb382ebt" path="res://scripts/player/ground/jump.gd" id="8_nwn0c"]
[ext_resource type="Script" uid="uid://brdohbduwyyb6" path="res://scripts/player/ground/fall.gd" id="9_y4pjd"]
[ext_resource type="Script" uid="uid://vptqvkhe206v" path="res://scripts/player/ground/crouch.gd" id="12_lgqa7"]
[ext_resource type="Material" uid="uid://sieciuw0oa22" path="res://assets/materials/screen_pixel.tres" id="15_fcs02"]
[ext_resource type="AudioStream" uid="uid://4u5ivtiif5oj" path="res://assets/sounds/step 1.mp3" id="16_lgqa7"]
[ext_resource type="Shader" uid="uid://nnm2vfpswuif" path="res://assets/shaders/canvas_pixel.gdshader" id="16_myrg7"]
[ext_resource type="AudioStream" uid="uid://doan5eyctitrk" path="res://assets/sounds/step 2.mp3" id="17_8ydkj"]
[ext_resource type="AudioStream" uid="uid://cbwsjme7v7t55" path="res://assets/sounds/step 3.mp3" id="18_3j4b4"]
[ext_resource type="Script" uid="uid://bdnt7gg01aapm" path="res://scripts/player/ground/run.gd" id="18_cnsyf"]
[ext_resource type="PackedScene" uid="uid://bchalkxryrgfy" path="res://scenes/torch.tscn" id="19_ioxgp"]
[ext_resource type="AudioStream" uid="uid://y8ma5gjdshwm" path="res://assets/sounds/step 4.mp3" id="19_yj68g"]
[ext_resource type="Script" uid="uid://dmnvhxj0y77t2" path="res://scripts/steps.gd" id="20_8ydkj"]
[ext_resource type="PackedScene" uid="uid://w0e5qalsukw6" path="res://scenes/chalk_item.tscn" id="22_cnsyf"]

[sub_resource type="Environment" id="Environment_ugbui"]
tonemap_mode = 4
glow_normalized = true
glow_bloom = 0.33
fog_mode = 1
fog_light_color = Color(0, 0, 0, 1)
fog_light_energy = 0.0
fog_density = 1.0
volumetric_fog_density = 0.25
volumetric_fog_albedo = Color(0, 0, 0, 1)
adjustment_enabled = true
adjustment_color_correction = ExtResource("3_8ydkj")

[sub_resource type="CapsuleMesh" id="CapsuleMesh_6agyq"]
radial_segments = 16
rings = 2

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_8xumb"]

[sub_resource type="AudioStreamRandomizer" id="AudioStreamRandomizer_ioxgp"]
random_pitch = 1.1892071
random_volume_offset_db = 3.0
streams_count = 4
stream_0/stream = ExtResource("16_lgqa7")
stream_1/stream = ExtResource("17_8ydkj")
stream_2/stream = ExtResource("18_3j4b4")
stream_3/stream = ExtResource("19_yj68g")

[sub_resource type="ShaderMaterial" id="ShaderMaterial_lgqa7"]

[sub_resource type="FastNoiseLite" id="FastNoiseLite_kvlxm"]
frequency = 0.3574
fractal_octaves = 10

[sub_resource type="NoiseTexture2D" id="NoiseTexture2D_gis51"]
noise = SubResource("FastNoiseLite_kvlxm")

[sub_resource type="Gradient" id="Gradient_uf5tr"]
interpolation_mode = 1
offsets = PackedFloat32Array(0)
colors = PackedColorArray(0, 0.014809188, 0.015851432, 1)

[sub_resource type="GradientTexture1D" id="GradientTexture1D_0bhws"]
gradient = SubResource("Gradient_uf5tr")
width = 1

[sub_resource type="ShaderMaterial" id="ShaderMaterial_8ydkj"]
shader = ExtResource("16_myrg7")
shader_parameter/pixel_size = 2.0000000475
shader_parameter/use_screen_texture = false
shader_parameter/use_dithering = true
shader_parameter/dither_type = 4
shader_parameter/dither_mode = 0
shader_parameter/dither_size = 4.000000142499999
shader_parameter/dither_amount = 1.0
shader_parameter/blue_noise_texture = SubResource("NoiseTexture2D_gis51")
shader_parameter/use_transparency = false
shader_parameter/alpha_threshold = 0.5
shader_parameter/use_dithered_transparency = true
shader_parameter/opacity = 1.0
shader_parameter/color_depth = 5.00000019
shader_parameter/use_gradient = true
shader_parameter/color_gradient = SubResource("GradientTexture1D_0bhws")
shader_parameter/gradient_mix = 1.0

[sub_resource type="Animation" id="Animation_kvlxm"]
resource_name = "fade_out"
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".:material:shader_parameter/opacity")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 1),
"transitions": PackedFloat32Array(1, 1),
"update": 0,
"values": [1.0, 0.0]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_uf5tr"]
_data = {
&"fade_out": SubResource("Animation_kvlxm")
}

[node name="player" type="CharacterBody3D" unique_id=1570651658 node_paths=PackedStringArray("step", "camera")]
axis_lock_angular_x = true
axis_lock_angular_y = true
axis_lock_angular_z = true
floor_constant_speed = true
floor_snap_length = 0.5
script = ExtResource("1_rkuj1")
maximum_speed = 10.0
jump_height = 2.5
step = NodePath("steps")
camera = NodePath("head/lean/camera")

[node name="WorldEnvironment" type="WorldEnvironment" parent="." unique_id=444993200]
environment = SubResource("Environment_ugbui")

[node name="head" type="Node3D" parent="." unique_id=951371490]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.5, 0)

[node name="lean" type="Node3D" parent="head" unique_id=1019706298]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -0.5, 0)

[node name="camera" type="Camera3D" parent="head/lean" unique_id=1055946145 node_paths=PackedStringArray("cam", "head", "lean")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.5, 0)
cull_mask = 1048573
fov = 90.0
far = 100000.0
script = ExtResource("2_qek5x")
cam = NodePath(".")
head = NodePath("../..")
lean = NodePath("..")
bob_interval = 1.5

[node name="pixelate" parent="head/lean/camera" unique_id=93580127 instance=ExtResource("5_kvlxm")]
visible = false

[node name="mesh" type="MeshInstance3D" parent="." unique_id=295009724]
layers = 4
material_override = ExtResource("2_h17s1")
mesh = SubResource("CapsuleMesh_6agyq")

[node name="collision" type="CollisionShape3D" parent="." unique_id=1018871596]
shape = SubResource("CapsuleShape3D_8xumb")

[node name="steps" type="AudioStreamPlayer3D" parent="." unique_id=59331114]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -0.854739, 0)
stream = SubResource("AudioStreamRandomizer_ioxgp")
bus = &"steps"
script = ExtResource("20_8ydkj")

[node name="Timer" type="Timer" parent="steps" unique_id=458050395]
process_callback = 0

[node name="logic" type="Node" parent="." unique_id=717132806]

[node name="input_gather" type="Node" parent="logic" unique_id=1968179394]
script = ExtResource("2_0owmy")

[node name="move" type="Node" parent="logic" unique_id=327719302 node_paths=PackedStringArray("initial_state")]
script = ExtResource("5_5tt2p")
initial_state = NodePath("idle")
metadata/_custom_type_script = "uid://dlyn7myxb1v18"

[node name="idle" type="Node" parent="logic/move" unique_id=739972491 node_paths=PackedStringArray("player")]
script = ExtResource("6_rkuj1")
player = NodePath("../../..")
metadata/_custom_type_script = "uid://bs6sc1frb1nfc"

[node name="walk" type="Node" parent="logic/move" unique_id=1904536783 node_paths=PackedStringArray("player")]
script = ExtResource("7_ers80")
player = NodePath("../../..")
metadata/_custom_type_script = "uid://b01bw7djd0wvp"

[node name="jump" type="Node" parent="logic/move" unique_id=1340535446 node_paths=PackedStringArray("player")]
script = ExtResource("8_nwn0c")
player = NodePath("../../..")
metadata/_custom_type_script = "uid://dmw47mb382ebt"

[node name="fall" type="Node" parent="logic/move" unique_id=1236452360 node_paths=PackedStringArray("player")]
script = ExtResource("9_y4pjd")
player = NodePath("../../..")
metadata/_custom_type_script = "uid://brdohbduwyyb6"

[node name="crouch" type="Node" parent="logic/move" unique_id=1066699845 node_paths=PackedStringArray("player")]
script = ExtResource("12_lgqa7")
player = NodePath("../../..")
metadata/_custom_type_script = "uid://vptqvkhe206v"

[node name="run" type="Node" parent="logic/move" unique_id=1994246396 node_paths=PackedStringArray("player")]
script = ExtResource("18_cnsyf")
player = NodePath("../../..")
metadata/_custom_type_script = "uid://bdnt7gg01aapm"

[node name="SubViewportContainer" type="SubViewportContainer" parent="." unique_id=897390686]
texture_filter = 1
material = SubResource("ShaderMaterial_lgqa7")
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
mouse_filter = 2

[node name="hand_view" type="SubViewport" parent="SubViewportContainer" unique_id=476380750]
transparent_bg = true
handle_input_locally = false
canvas_item_default_texture_filter = 0
size = Vector2i(960, 540)
render_target_update_mode = 4

[node name="camera" type="Camera3D" parent="SubViewportContainer/hand_view" unique_id=1232050989 node_paths=PackedStringArray("node_to_match")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.5, 0)
cull_mask = 1047554
fov = 90.0
far = 1000000.0
script = ExtResource("6_fm80t")
node_to_match = NodePath("../../../head/lean/camera")

[node name="sway" type="Node3D" parent="SubViewportContainer/hand_view" unique_id=568651731 node_paths=PackedStringArray("player", "camera", "holder")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.5, 0)
script = ExtResource("3_ioxgp")
player = NodePath("../../..")
camera = NodePath("../camera")
holder = NodePath("holder")

[node name="holder" type="Node3D" parent="SubViewportContainer/hand_view/sway" unique_id=567501717]

[node name="torch" type="Node3D" parent="SubViewportContainer/hand_view/sway/holder" unique_id=1298538801]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.5, 0)

[node name="torch" parent="SubViewportContainer/hand_view/sway/holder/torch" unique_id=1836886530 instance=ExtResource("19_ioxgp")]
transform = Transform3D(0.27766678, 0, -0.96067744, 0, 1, 0, 0.96067744, 0, 0.27766678, -0.512, -0.655, -0.59)

[node name="Cylinder" parent="SubViewportContainer/hand_view/sway/holder/torch/torch" index="0" unique_id=1062861853]
layers = 2

[node name="Cylinder_001" parent="SubViewportContainer/hand_view/sway/holder/torch/torch" index="1" unique_id=1062649697]
layers = 2

[node name="Cylinder_002" parent="SubViewportContainer/hand_view/sway/holder/torch/torch" index="2" unique_id=838068679]
layers = 2

[node name="Cylinder_003" parent="SubViewportContainer/hand_view/sway/holder/torch/torch" index="3" unique_id=1397636730]
layers = 2

[node name="OmniLight3D" parent="SubViewportContainer/hand_view/sway/holder/torch/torch" index="4" unique_id=592766888]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -0.012091517, 0.29021314, -0.011543274)
layers = 2
light_energy = 2.3457487
shadow_blur = 1.4382993

[node name="Sprite3D2" parent="SubViewportContainer/hand_view/sway/holder/torch/torch/OmniLight3D" index="0" unique_id=1329841238]
transform = Transform3D(0.27454087, 0, -0.9615754, 0, 0.5164572, 0, 0.9615754, 0, 0.27454087, 1.1920929e-07, -0.06456745, 0.00080662966)
layers = 2
frame = 3
is_flipped = true

[node name="Sprite3D3" parent="SubViewportContainer/hand_view/sway/holder/torch/torch/OmniLight3D" index="1" unique_id=1148831848]
transform = Transform3D(0.22111654, 0, -0.97524714, 0, 0.5164572, 0, 0.97524714, 0, 0.22111654, 1.1920929e-07, -0.06456745, 0.00080662966)
layers = 2
frame = 3

[node name="Sprite3D4" parent="SubViewportContainer/hand_view/sway/holder/torch/torch/OmniLight3D" index="2" unique_id=1923378448]
transform = Transform3D(0.018002229, 0, 0.9998376, 0, 0.51436794, 0, -0.9998376, 0, 0.018002229, 0, -0.05956757, 0.00080662966)
layers = 2
frame = 3

[node name="fire" parent="SubViewportContainer/hand_view/sway/holder/torch/torch/OmniLight3D" index="3" unique_id=2084859198]
layers = 2

[node name="smoke" parent="SubViewportContainer/hand_view/sway/holder/torch/torch/OmniLight3D" index="4" unique_id=2081439854]
layers = 2

[node name="chalk" parent="SubViewportContainer/hand_view/sway/holder" unique_id=1123505354 instance=ExtResource("22_cnsyf")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.5, 0)

[node name="CanvasLayer" type="CanvasLayer" parent="." unique_id=650718009]

[node name="Control" type="ColorRect" parent="CanvasLayer" unique_id=485828585]
material = ExtResource("15_fcs02")
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
mouse_filter = 2
metadata/_edit_use_anchors_ = true

[node name="dither_trans" type="ColorRect" parent="CanvasLayer" unique_id=2018062212]
modulate = Color(0, 0, 0, 1)
self_modulate = Color(0, 0, 0, 1)
material = SubResource("ShaderMaterial_8ydkj")
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
mouse_filter = 2
color = Color(0, 0, 0, 1)
metadata/_edit_use_anchors_ = true

[node name="AnimationPlayer" type="AnimationPlayer" parent="CanvasLayer/dither_trans" unique_id=210986631]
libraries/ = SubResource("AnimationLibrary_uf5tr")

[editable path="SubViewportContainer/hand_view/sway/holder/torch/torch"]
[editable path="SubViewportContainer/hand_view/sway/holder/chalk"]
[editable path="SubViewportContainer/hand_view/sway/holder/chalk/chalk"]
